<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Twitter STX Tipping Bot</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/@stacks/connect@latest"></script>
</head>
<body>
  <header>
    <h1>STX Twitter Bot</h1>
    <p>Send and receive STX tips via Twitter replies!</p>
  </header>

  <section>
    <h2>Sign In with Xverse or Leather</h2>
    <p>Connect your Stacks wallet to get started with tipping.</p>
    <input type="text" id="twitter-handle" placeholder="Enter your Twitter handle">
    <button id="connect-wallet">Sign In with Xverse or Leather</button>
  </section>

  <section>
    <h2>Features</h2>
    <ul>
      <li>Wallet onboarding system for users to create and link their Stacks wallets</li>
      <li>Streamlined tipping process that automatically identifies the user's wallet</li>
      <li>Automatic tweet responses confirming successful transactions</li>
      <li>Error handling for invalid commands or failed transactions</li>
      <li>Integration with Supabase for transaction history storage</li>
    </ul>
  </section>

  <section>
    <h2>How It Works</h2>
    <p>To send a tip, simply reply to a tweet with the bot mentioned and include the amount of STX you want to send. For example, "10 STX". The bot will handle the rest and send a confirmation tweet.</p>
  </section>

  <section>
    <h2>Get Started</h2>
    <p>Follow the instructions in the <a href="README.md">README</a> to deploy your own Twitter STX Tipping Bot.</p>
  </section>

  <footer>
    <p>Created by NoCodeClarity</p>
    <p>Licensed under the MIT License</p>
  </footer>

  <script>
    const connectWalletButton = document.getElementById('connect-wallet');

    connectWalletButton.addEventListener('click', () => {
      const twitterHandle = document.getElementById('twitter-handle').value;

      if (!twitterHandle) {
        alert('Please enter your Twitter handle.');
        return;
      }

      const appConfig = new StacksConnect({
        appDetails: {
          name: 'Twitter STX Tipping Bot',
          icon: 'https://example.com/icon.png',
        },
        redirectTo: '/',
        userSession: new UserSession({ appConfig: new AppConfig(['store_write', 'publish_data']) }),
      });

      appConfig.authenticate({
        onFinish: (authResponse) => {
          const userSession = new UserSession();
          const userData = userSession.loadUserData();
          const walletAddress = userData.profile.stxAddress.testnet; // Use .mainnet for mainnet
          alert(`Wallet connected: ${walletAddress}`);

          // Send wallet address and Twitter handle to your backend or Supabase
          fetch('/api/save-wallet', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ walletAddress, twitterHandle })
          }).then(response => {
            if (response.ok) {
              console.log('Wallet address saved successfully.');
              alert('Your wallet has been successfully linked to your Twitter handle!');
            } else {
              console.error('Failed to save wallet address.');
              alert('Failed to link wallet. Please try again.');
            }
          });
        },
      });
    });
  </script>
</body>
</html>
